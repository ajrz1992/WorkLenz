"use strict";(self.webpackChunkworklenz=self.webpackChunkworklenz||[]).push([[945],{83945:(Ce,z,a)=>{a.r(z),a.d(z,{RptAllocationModule:()=>se});var u=a(96814),v=a(35420),g=a(15861),T=a(69649),j=a(71993),J=a(63019),O=a(16676),s=a.n(O),p=a(21406),e=a(65879),P=a(90586),F=a(16196),N=a(69342),U=a(42012),A=a(63106),b=a(62595),k=a(48128),x=a(24139),y=a(96109),Z=a(8083),Q=a(10095),f=a(92574),_=a(73460),h=a(62787),D=a(42840),I=a(70855),L=a(41958),w=a(62612),S=a(20824),M=a(60804),C=a(60095),R=a(33640),Y=a(76271),B=a(9172);function H(o,c){if(1&o&&(e.TgZ(0,"button",26),e._uU(1," Teams "),e._UZ(2,"span",27),e.qZA()),2&o){const l=e.oxw(),n=e.MAs(15);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",l.loadingTeams)("nzTrigger","click")}}function $(o,c){if(1&o&&(e.TgZ(0,"button",26),e._uU(1," Categories "),e._UZ(2,"span",27),e.qZA()),2&o){const l=e.oxw(),n=e.MAs(26);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",l.loadingCategories)("nzTrigger","click")}}function K(o,c){if(1&o&&(e.TgZ(0,"button",26),e._uU(1," Projects "),e._UZ(2,"span",27),e.qZA()),2&o){const l=e.oxw(),n=e.MAs(39);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",l.loadingProjects)("nzTrigger","click")}}function G(o,c){if(1&o&&(e.TgZ(0,"button",28),e._uU(1," Billable "),e._UZ(2,"span",27),e.qZA()),2&o){e.oxw();const l=e.MAs(8);e.Q6J("nzDropdownMenu",l)("nzClickHide",!1)("nzTrigger","click")}}function W(o,c){if(1&o){const l=e.EpF();e.TgZ(0,"li",6),e.NdJ("nzCheckedChange",function(t){const r=e.CHM(l).$implicit;return e.KtG(r.selected=t)})("nzCheckedChange",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.checkTeam())}),e._uU(1),e.qZA()}if(2&o){const l=c.$implicit;e.Q6J("nzChecked",l.selected),e.xp6(1),e.hij(" ",l.name," ")}}function E(o,c){if(1&o){const l=e.EpF();e.TgZ(0,"li",6),e.NdJ("nzCheckedChange",function(t){const r=e.CHM(l).$implicit;return e.KtG(r.selected=t)})("nzCheckedChange",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.checkCategory())}),e.TgZ(1,"div",29)(2,"div")(3,"span",30),e._UZ(4,"nz-badge",31),e.qZA()()()()}if(2&o){const l=c.$implicit;e.Q6J("nzChecked",l.selected),e.xp6(4),e.Q6J("nzColor",l.color_code)("nzText",l.name)}}function V(o,c){if(1&o){const l=e.EpF();e.TgZ(0,"li",6),e.NdJ("nzCheckedChange",function(t){const r=e.CHM(l).$implicit;return e.KtG(r.selected=t)})("nzCheckedChange",function(){e.CHM(l);const t=e.oxw();return e.KtG(t.checkProject())}),e.TgZ(1,"div",29)(2,"div")(3,"span",32),e._uU(4),e.qZA()()()()}if(2&o){const l=c.$implicit;e.Q6J("nzChecked",l.selected),e.xp6(4),e.Oqu(l.name)}}function X(o,c){1&o&&e._UZ(0,"nz-empty",33),2&o&&e.Q6J("nzNotFoundContent","No time logs found!")}function q(o,c){if(1&o&&(e.TgZ(0,"div",38),e._uU(1),e.qZA()),2&o){const l=c.$implicit;e.xp6(1),e.hij(" ",l.name," ")}}function ee(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"div",34),e._UZ(2,"div",35),e.YNc(3,q,2,1,"div",36),e.TgZ(4,"div",37),e._uU(5,"Total"),e.qZA()(),e.BQk()),2&o){const l=e.oxw();e.xp6(3),e.Q6J("ngForOf",l.members)}}function te(o,c){if(1&o&&(e.TgZ(0,"div",46),e._uU(1),e.qZA()),2&o){const l=c.$implicit;e.xp6(1),e.hij(" ",l.time_logged," ")}}function ne(o,c){if(1&o&&(e.TgZ(0,"div",40)(1,"div",35),e._UZ(2,"span",41),e.ALo(3,"safeString"),e.ALo(4,"safeString"),e.TgZ(5,"span",42),e._uU(6),e.qZA(),e.TgZ(7,"div",30),e._UZ(8,"nz-progress",43),e.ALo(9,"safeString"),e.qZA()(),e.YNc(10,te,2,1,"div",44),e.TgZ(11,"div",45),e._uU(12),e.qZA()()),2&o){const l=c.$implicit;e.xp6(2),e.Udp("color",l.status_color_code),e.Q6J("nzType",e.lcZ(3,11,l.status_icon))("nzTooltipTitle",e.lcZ(4,13,l.status_name)),e.xp6(4),e.Oqu(l.name),e.xp6(2),e.Q6J("nzPercent",l.progress)("nzStrokeColor",e.lcZ(9,15,l.color_code))("nzTooltipTitle",l.completed_tasks_count+" of "+l.all_tasks_count)("nzSize","small"),e.xp6(2),e.Q6J("ngForOf",l.time_logs),e.xp6(2),e.Oqu(l.total)}}function oe(o,c){if(1&o&&(e.ynx(0),e.YNc(1,ne,13,17,"div",39),e.BQk()),2&o){const l=e.oxw();e.xp6(1),e.Q6J("ngForOf",l.projects)}}function ie(o,c){if(1&o&&(e.TgZ(0,"div",50),e._uU(1),e.qZA()),2&o){const l=c.$implicit;e.xp6(1),e.hij(" ",l.total_time," ")}}function le(o,c){if(1&o&&(e.TgZ(0,"div",47)(1,"div",48),e._uU(2,"Total"),e.qZA(),e.YNc(3,ie,2,1,"div",49),e._UZ(4,"div",45),e.qZA()),2&o){const l=e.oxw();e.xp6(3),e.Q6J("ngForOf",l.members)}}const re=[{path:"",component:(()=>{var o;class c{constructor(n,t,i,r,d){this.app=n,this.api=t,this.cdr=i,this.exportApi=r,this.service=d,this.loadingProjects=!1,this.loadingCategories=!1,this.loadingTeams=!1,this.loading=!1,this.selectAllTeams=!0,this.selectAllProjects=!0,this.selectAllCategories=!0,this.selectNoCategory=!0,this.isDurationLabelSelected=!0,this.categorySearchText=null,this.teamSearchText=null,this.projectSearchText=null,this.projects=[],this.members=[],this.teamsDropDown=[],this.projectsDropdown=[],this.categoriesDropdown=[],this.billableDropdownOptions={billable:!0,nonBillable:!0},this.app.setTitle("Reporting - Allocation"),(0,J.T)(this.service.onDurationChange,this.service.onDateRangeChange,this.service.onIncludeToggleChange).pipe((0,j.sL)()).subscribe(()=>{this.getAllocationData()})}ngOnInit(){this.getTeams()}getSelectedTeamIds(){return this.teamsDropDown.filter(i=>i.selected).map(i=>i.id)||[]}getSelectedCategories(){return this.categoriesDropdown.filter(i=>i.selected).map(i=>i.id)||[]}getSelectedProjectIds(){return this.projectsDropdown.filter(i=>i.selected).map(i=>i.id)||[]}selectAllCategoriesChecked(n){if(n){this.selectNoCategory=!0;for(const t of this.categoriesDropdown)t.selected=!0;this.refreshProjects(),this.cdr.markForCheck()}else{this.selectNoCategory=!1;for(const t of this.categoriesDropdown)t.selected=!1;this.refreshProjects(),this.cdr.markForCheck()}}getCategories(n){var t=this;return(0,g.Z)(function*(){try{t.loadingCategories=!0;const i=yield t.api.getCategories(n);i.done&&(t.categoriesDropdown=i.body),t.loadingCategories=!1,t.cdr.markForCheck()}catch{t.loadingCategories=!1,t.cdr.markForCheck()}})()}setDatesForKeys(){var n=this;return(0,g.Z)(function*(){if(n.service.getDuration()?.key){const t=n.service.getDuration()?.key,i=s()();switch(t){case p.WD:const r=s()().subtract(1,"days");n.service.setDateRange([r.toString(),r.toString()]);break;case p.ao:const d=s()().subtract(1,"weeks");n.service.setDateRange([d.toString(),i.toString()]);break;case p.ly:const m=s()().subtract(1,"months");n.service.setDateRange([m.toString(),i.toString()]);break;case p.o9:const de=s()().subtract(3,"months");n.service.setDateRange([de.toString(),i.toString()]);break;case p.$U:const ge=s()().subtract(1,"weeks").startOf("week"),pe=s()().subtract(1,"weeks").endOf("week");n.service.setDateRange([ge.toString(),pe.toString()]);break;case p.lI:const me=s()().subtract(1,"month").startOf("month"),he=s()().subtract(1,"month").endOf("month");n.service.setDateRange([me.toString(),he.toString()])}}})()}getAllocationData(){var n=this;return(0,g.Z)(function*(){try{n.loading=!0,n.isDurationLabelSelected&&(yield n.setDatesForKeys());const t=n.getSelectedTeamIds(),i=n.getSelectedProjectIds(),r=n.service.getDuration()?.key,d={teams:t,projects:i,duration:r,date_range:n.service.getDateRange(),archived:n.service.getIncludeToggle(),billable:n.billableDropdownOptions},m=yield n.api.getAllocationData(d,n.service.getIncludeToggle());m.done&&(n.members=m.body.users,n.projects=m.body.projects),n.loading=!1}catch{n.loading=!1}n.cdr.markForCheck()})()}refreshCategories(){var n=this;return(0,g.Z)(function*(){yield n.getCategories(n.getSelectedTeamIds()),n.refreshProjects()})()}refreshProjects(){this.getProjects(this.getSelectedTeamIds(),this.getSelectedCategories())}getProjects(n,t){var i=this;return(0,g.Z)(function*(){try{i.loadingProjects=!0;const r=yield i.api.getAllocationProjects(n,t,i.selectNoCategory);r.done&&(i.projectsDropdown=r.body,i.getAllocationData()),i.loadingProjects=!1}catch{i.loadingProjects=!1}i.cdr.markForCheck()})()}getTeams(){var n=this;return(0,g.Z)(function*(){try{n.loadingTeams=!0;const t=yield n.api.getOverviewTeams();if(t.done){n.loadingTeams=!1;const i=[];for(const r of t.body)i.push({selected:!0,name:r.name,id:r.id});n.teamsDropDown=i,n.refreshCategories(),n.cdr.markForCheck()}}catch(t){(0,T.tu)(t),n.loadingTeams=!1}})()}export(){var n=this;return(0,g.Z)(function*(){try{const t=n.getSelectedTeamIds(),i=n.getSelectedProjectIds();n.isDurationLabelSelected&&(yield n.setDatesForKeys());const r=n.service.getDuration()?.key;n.service.getDateRange(),n.service.getIncludeToggle(),n.exportApi.exportAllocation(n.service.getIncludeToggle(),t,i,r,n.service.getDateRange())}catch(t){(0,T.tu)(t)}})()}checkTeam(){this.selectAllTeams=!1,this.refreshCategories()}checkCategory(){this.selectAllCategories=!1,this.refreshProjects()}checkProject(){this.selectAllProjects=!1,this.getAllocationData()}selectAllTeamsChecked(n){if(n){for(const t of this.teamsDropDown)t.selected=!0;this.refreshProjects(),this.cdr.markForCheck()}else{for(const t of this.teamsDropDown)t.selected=!1;this.refreshProjects(),this.cdr.markForCheck()}}selectAllProjectsChecked(n){if(n){for(const t of this.projectsDropdown)t.selected=!0;this.getAllocationData(),this.cdr.markForCheck()}else{for(const t of this.projectsDropdown)t.selected=!1;this.getAllocationData(),this.cdr.markForCheck()}}toggleBillableStatus(n){this.getAllocationData()}}return(o=c).\u0275fac=function(n){return new(n||o)(e.Y36(P.z),e.Y36(F.U),e.Y36(e.sBO),e.Y36(N.O),e.Y36(U.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["worklenz-rpt-allocation"]],decls:57,vars:28,consts:[[3,"title","isDurationLabelSelected","exportFile"],["nz-row",""],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzLoading","nzTrigger",4,"nzSpaceItem"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzTrigger",4,"nzSpaceItem"],["billableDropdown","nzDropdownMenu"],["nz-menu","",1,"pt-0",2,"max-height","330px","overflow-y","auto"],["nz-checkbox","","nz-menu-item","",1,"m-0","align-items-baseline",3,"nzChecked","nzCheckedChange"],["teamsDropdown","nzDropdownMenu"],[1,"px-3","py-2","sticky-top","bg-white"],["type","text","placeholder","Search by team name","nz-input","",3,"ngModel","ngModelChange"],["teamSearchInput",""],["nz-menu-divider",""],["class","m-0 align-items-baseline","nz-checkbox","","nz-menu-item","",3,"nzChecked","nzCheckedChange",4,"ngFor","ngForOf"],["categorySelector","nzDropdownMenu"],["type","text","placeholder","Search by category name","nz-input","",3,"ngModel","ngModelChange"],["categorySearchInput",""],["projectsSelector","nzDropdownMenu"],["type","text","placeholder","Search by project name","nz-input","",3,"ngModel","ngModelChange"],["projectSearchInput",""],[3,"nzLoading","nzActive"],[1,"row-fix"],[1,"table-container","mt-3"],[1,"member-project-table"],[3,"nzNotFoundContent",4,"ngIf"],[4,"ngIf"],["class","table-row_ d-flex bottom-row",4,"ngIf"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzLoading","nzTrigger"],["nz-icon","","nzType","caret-down"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzTrigger"],[1,"d-flex","align-items-center","justify-content-center","user-select-none"],[1,"d-block"],[3,"nzColor","nzText"],["nz-typography","",1,"d-block"],[3,"nzNotFoundContent"],[1,"header-row","d-flex"],[1,"project-name"],["class","member-name f-500",4,"ngFor","ngForOf"],[1,"total-time","text-center"],[1,"member-name","f-500"],["class","table-row_ d-flex",4,"ngFor","ngForOf"],[1,"table-row_","d-flex"],["nz-icon","","nz-tooltip","",3,"nzType","nzTooltipTitle"],[1,"ms-1"],["nz-tooltip","",3,"nzPercent","nzStrokeColor","nzTooltipTitle","nzSize"],["class","member-time",4,"ngFor","ngForOf"],[1,"total-time"],[1,"member-time"],[1,"table-row_","d-flex","bottom-row"],[1,"project-name","bg-bold"],["class","member-total-time bg-bold",4,"ngFor","ngForOf"],[1,"member-total-time","bg-bold"]],template:function(n,t){if(1&n&&(e.TgZ(0,"worklenz-rpt-header",0),e.NdJ("isDurationLabelSelected",function(r){return t.isDurationLabelSelected=r})("exportFile",function(){return t.export()}),e.qZA(),e.TgZ(1,"div",1)(2,"nz-space"),e.YNc(3,H,3,4,"button",2),e.YNc(4,$,3,4,"button",2),e.YNc(5,K,3,4,"button",2),e.YNc(6,G,3,3,"button",3),e.qZA()(),e.TgZ(7,"nz-dropdown-menu",null,4)(9,"ul",5)(10,"li",6),e.NdJ("nzCheckedChange",function(r){return t.billableDropdownOptions.billable=r})("nzCheckedChange",function(){return t.toggleBillableStatus("billable")}),e._uU(11,"Billable "),e.qZA(),e.TgZ(12,"li",6),e.NdJ("nzCheckedChange",function(r){return t.billableDropdownOptions.nonBillable=r})("nzCheckedChange",function(){return t.toggleBillableStatus("nonBillable")}),e._uU(13,"Non Billable "),e.qZA()()(),e.TgZ(14,"nz-dropdown-menu",null,7)(16,"ul",5)(17,"li",8)(18,"input",9,10),e.NdJ("ngModelChange",function(r){return t.teamSearchText=r}),e.qZA()(),e.TgZ(20,"li",6),e.NdJ("nzCheckedChange",function(r){return t.selectAllTeams=r})("nzCheckedChange",function(r){return t.selectAllTeamsChecked(r)}),e._uU(21,"Select all "),e.qZA(),e._UZ(22,"li",11),e.YNc(23,W,2,2,"li",12),e.ALo(24,"searchByName"),e.qZA()(),e.TgZ(25,"nz-dropdown-menu",null,13)(27,"ul",5)(28,"li",8)(29,"input",14,15),e.NdJ("ngModelChange",function(r){return t.categorySearchText=r}),e.qZA()(),e.TgZ(31,"li",6),e.NdJ("nzCheckedChange",function(r){return t.selectAllCategories=r})("nzCheckedChange",function(r){return t.selectAllCategoriesChecked(r)}),e._uU(32,"Select all "),e.qZA(),e._UZ(33,"li",11),e.TgZ(34,"li",6),e.NdJ("nzCheckedChange",function(r){return t.selectNoCategory=r})("nzCheckedChange",function(){return t.checkCategory()}),e._uU(35," No Category "),e.qZA(),e.YNc(36,E,5,3,"li",12),e.ALo(37,"searchByName"),e.qZA()(),e.TgZ(38,"nz-dropdown-menu",null,16)(40,"ul",5)(41,"li",8)(42,"input",17,18),e.NdJ("ngModelChange",function(r){return t.projectSearchText=r}),e.qZA()(),e.TgZ(44,"li",6),e.NdJ("nzCheckedChange",function(r){return t.selectAllProjects=r})("nzCheckedChange",function(r){return t.selectAllProjectsChecked(r)}),e._uU(45,"Select all "),e.qZA(),e._UZ(46,"li",11),e.YNc(47,V,5,2,"li",12),e.ALo(48,"searchByName"),e.qZA()(),e.TgZ(49,"nz-skeleton",19)(50,"div",20)(51,"div",21)(52,"div",22),e.YNc(53,X,1,1,"nz-empty",23),e.YNc(54,ee,6,1,"ng-container",24),e.YNc(55,oe,2,1,"ng-container",24),e.YNc(56,le,5,1,"div",25),e.qZA()()()()),2&n){const i=e.MAs(19),r=e.MAs(30),d=e.MAs(43);e.Q6J("title","Time Sheet"),e.xp6(10),e.Q6J("nzChecked",t.billableDropdownOptions.billable),e.xp6(2),e.Q6J("nzChecked",t.billableDropdownOptions.nonBillable),e.xp6(6),e.Q6J("ngModel",t.teamSearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllTeams),e.xp6(3),e.Q6J("ngForOf",e.xi3(24,19,t.teamsDropDown,i.value)),e.xp6(6),e.Q6J("ngModel",t.categorySearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllCategories),e.xp6(3),e.Q6J("nzChecked",t.selectNoCategory),e.xp6(2),e.Q6J("ngForOf",e.xi3(37,22,t.categoriesDropdown,r.value)),e.xp6(6),e.Q6J("ngModel",t.projectSearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllProjects),e.xp6(3),e.Q6J("ngForOf",e.xi3(48,25,t.projectsDropdown,d.value)),e.xp6(2),e.Q6J("nzLoading",t.loading)("nzActive",!0),e.xp6(4),e.Q6J("ngIf",!t.loading&&!t.members.length&&!t.projects.length),e.xp6(1),e.Q6J("ngIf",t.members.length),e.xp6(1),e.Q6J("ngIf",t.projects.length),e.xp6(1),e.Q6J("ngIf",t.members.length&&t.projects.length)}},dependencies:[u.sg,u.O5,A.I,b.Ls,k.M,x.ng,y.SY,Z.ZU,Q.SK,f.NU,f.$1,_.wO,_.r9,_.YV,h.cm,h.RR,h.wA,D.ix,I.w,L.dQ,w.Ie,S.Zp,M.p9,C.Fj,C.JJ,C.On,R.x7,Y.m,B.g],styles:[".project-name[_ngcontent-%COMP%]{width:200px;position:sticky;left:0;background:white;padding:16px 8px 16px 12px;border-left:1px solid #f5f5f5;border-right:1px solid #f5f5f5;border-bottom:1px solid #f5f5f5}.member-time[_ngcontent-%COMP%], .member-name[_ngcontent-%COMP%], .member-total-time[_ngcontent-%COMP%]{width:100px;border-right:1px solid #f5f5f5;padding:16px 6px}.member-time[_ngcontent-%COMP%]{font-size:13px;border-bottom:1px solid #f5f5f5;color:hwb(0 0% 100%/.65);text-align:center;display:flex;align-items:center;justify-content:center}.member-name[_ngcontent-%COMP%]{border-bottom:1px solid #f5f5f5;border-top:1px solid #f5f5f5;text-overflow:ellipsis;overflow:hidden}.header-row[_ngcontent-%COMP%], .table-row_[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}.header-row[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:9}.header-row[_ngcontent-%COMP%]   .project-name[_ngcontent-%COMP%]{border-left:none!important}.total-time[_ngcontent-%COMP%]{width:120px;position:sticky;right:0;background:#f8f7f9;text-align:center;font-weight:500;padding:16px 12px;border-bottom:1px solid #f1f1f1;display:flex;align-items:center;justify-content:center}.bg-bold[_ngcontent-%COMP%]{background:#f8f7f9;font-weight:500}.f-500[_ngcontent-%COMP%]{font-weight:500}.member-project-table[_ngcontent-%COMP%]{overflow:auto;max-height:calc(100vh - 250px)}.border-top[_ngcontent-%COMP%]{border-top:1px solid #f0f0f0!important}.badge-custom[_ngcontent-%COMP%]{margin-top:-3px!important;margin-right:4px}.no-data-img-holder[_ngcontent-%COMP%]{width:100px;margin-top:42px}.bottom-row[_ngcontent-%COMP%]{position:sticky;bottom:0}"],changeDetection:0}),c})()}];let ae=(()=>{var o;class c{}return(o=c).\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(re),v.Bz]}),c})();var ce=a(3599);let se=(()=>{var o;class c{}return(o=c).\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[u.ez,ae,A.I,b.PV,k.W,x.H0,y.cg,Z.ZJ,ce.U5,f.zf,h.b1,D.sL,w.Wr,S.o7,M.Xo,C.u5,R.mS]}),c})()}}]);